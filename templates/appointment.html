<!DOCTYPE html>
<h3>Make an appointment here</h3>

<form action="" method = "POST" id="my_form">
  {% csrf_token %}
  {% for field in form %}

  <label class="form-label">{{field.label}}</label>

  {{field}}
  <br>
  {% endfor %}
  {{form.errors}}
  <input type="submit"  class ="btn btn-primary">
</form>
<script>

  function getCookie(name) {
              let cookieValue = null;
              if (document.cookie && document.cookie !== '') {
                  const cookies = document.cookie.split(';');
                  for (let i = 0; i < cookies.length; i++) {
                      const cookie = cookies[i].trim();
                      // Does this cookie string begin with the name we want?
                      if (cookie.substring(0, name.length + 1) === (name + '=')) {
                          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                          break;
                      }
                  }
              }
              return cookieValue;
          }
          const csrftoken = getCookie('csrftoken');

  let department_field = document.getElementById("id_department")
  let doctor_field = document.getElementById("id_doctor")

  department_field.addEventListener("change", pickState)
  function pickState(e){
    console.log(e.target.value)
    let department_id = e.target.value
    const data = { user_id: department_id};
    let url = " {% url 'doctors' %} "

    fetch(url, {
      method: 'POST', // or 'PUT'
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => {
      console.log('Success:', data);
      doctor_field.innerHTML= '<option value= "" selected = ""> ------</option>'
      for (let i = 0; i< data.length; i++){
        doctor_field.innerHTML += `<option value = "${data[i]["first_name"]} ${data[i]["last_name"]}" selected>${data[i]["first_name"]} ${data[i]["last_name"]} </option>`
      }
    })
    .catch((error) => {
      console.error('Error:', error);
    });

}






</script>
